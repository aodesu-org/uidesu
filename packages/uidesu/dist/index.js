#!/usr/bin/env node
import {g as g$1}from'./chunk-TLNIZBSZ.js';import {Command}from'commander';import {promises,existsSync}from'fs';import h,{join}from'path';import d,{z}from'zod';import {green,cyan,yellow,red}from'kleur/colors';import V from'fast-glob';import l from'fs-extra';import {loadConfig}from'tsconfig-paths';import H from'ora';import {detect}from'@antfu/ni';import te from'prompts';import Q from'os';import {execa}from'execa';var S={version:"1.0.0"};var s={error:red,warn:yellow,info:cyan,success:green};var i={error(...e){console.log(s.error(e.join(" ")));},warn(...e){console.log(s.warn(e.join(" ")));},info(...e){console.log(s.info(e.join(" ")));},success(...e){console.log(s.success(e.join(" ")));},log(...e){console.log(e.join(" "));},break(){console.log("");}};d.object({cwd:d.string(),registryFile:d.string(),outputDir:d.string()});var E=new Command().name("build").description("build components for a aodesu registry").argument("[registry]","path to registry.json file","./registry.json").option("-o, --output <path>","destination directory for json files","./public/r").option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).action(async(e,t)=>{try{let r=h.resolve(t.cwd),o=h.resolve(r,t.output),n=h.resolve(r,e),a=await promises.readFile(n,"utf-8"),p=g$1.parse(JSON.parse(a));await promises.mkdir(o,{recursive:!0});let c=p.items.map(m=>({name:m.name,type:m.type}));await promises.writeFile(h.join(o,"index.json"),JSON.stringify(c,null,2)),i.info(`\u2713 Generated ${c.length} items`),i.info(`\u2713 Output directory: ${o}`);}catch(r){r instanceof d.ZodError?(i.error("Invalid registry.json format"),r.errors.forEach(o=>{i.error(`  ${o.path.join(".")}: ${o.message}`);})):r instanceof Error?i.error(r.message):i.error("Unknown error occurred"),process.exit(1);}});var u={"next-app":{name:"next-app",label:"Next.js",links:{installation:"https://ui.uidesu.com/docs/installation/next",tailwind:"https://tailwindcss.com/docs/guides/nextjs"}},"next-pages":{name:"next-pages",label:"Next.js",links:{installation:"https://ui.uidesu.com/docs/installation/next",tailwind:"https://tailwindcss.com/docs/guides/nextjs"}},vite:{name:"vite",label:"Vite",links:{installation:"https://ui.uidesu.com/docs/installation/vite",tailwind:"https://tailwindcss.com/docs/guides/vite"}},manual:{name:"manual",label:"Manual",links:{installation:"https://ui.uidesu.com/docs/installation/manual",tailwind:"https://tailwindcss.com/docs/installation"}}};var K=["**/node_modules/**",".next","public","dist","build"];async function g(e){let[t,r,o]=await Promise.all([V.glob("**/{next,vite,astro,app}.config.*|gatsby-config.*|composer.json|react-router.config.*",{cwd:e,deep:3,ignore:K}),l.pathExists(h.resolve(e,"src")),Y(e)]),n=await l.pathExists(h.resolve(e,`${r?"src/":""}app`)),a={framework:u.manual,isSrcDir:r,aliasPrefix:o};return t.find(p=>p.startsWith("next.config."))?.length?(a.framework=n?u["next-app"]:u["next-pages"],a):(t.find(p=>p.startsWith("vite.config."))?.length&&(a.framework=u.vite),a)}async function Y(e){let t=await loadConfig(e);if(t?.resultType==="failed"||!Object.entries(t?.paths).length)return null;for(let[r,o]of Object.entries(t.paths))if(o.includes("./*")||o.includes("./src/*")||o.includes("./app/*")||o.includes("./resources/js/*"))return r.replace(/\/\*$/,"")??null;return Object.keys(t?.paths)?.[0].replace(/\/\*$/,"")??null}function w(e,t){return H({text:e,isSilent:t?.silent})}async function F(e){let t={};if(!l.existsSync(e.cwd)||!l.existsSync(h.resolve(e.cwd,"package.json")))return t["1"]=true,{errors:t,ProjectInfo:null};let r=w("Preflight checks.").start();l.existsSync(h.resolve(e.cwd,"uidesu.config.json"))&&(r?.fail(),i.break(),i.error(`A ${s.info("uidesu.config.json")} file already exists at ${s.info(e.cwd)}.
To start over, remove the ${s.info("uidesu.config.json")} file and run ${s.info("uidesu init")} again.`),i.break(),process.exit(1)),r?.succeed();let o=w("Verifying framework.").start(),n=await g(e.cwd);return (!n||n?.framework.name==="manual")&&(t["7"]=true,o?.fail(),i.break(),n?.framework.links.installation&&i.error(`We could not detect a supported framework at ${s.info(e.cwd)}.
Visit ${s.info(n?.framework.links.installation)} to manually configure your project.
Once configured, you can use the cli to add components.`),i.break(),process.exit(1)),o?.succeed(`Verifying framework. Found ${s.info(n.framework.label)}.`),{errors:t,projectInfo:n}}async function M(e,{withFallback:t}={withFallback:false}){let r=await detect({programmatic:true,cwd:e});if(r==="yarn@berry")return "yarn";if(r==="pnpm@6")return "pnpm";if(r==="bun")return "bun";if(r==="deno")return "deno";if(!t)return r??"npm";let o=process.env.npm_config_user_agent||"";return o.startsWith("yarn")?"yarn":o.startsWith("pnpm")?"pnpm":o.startsWith("bun")?"bun":"npm"}var X="https://codeload.github.com/shadcn-ui/ui/tar.gz/main";async function v(e,t){let r=w("Creating a new Vite project. This may take a few minutes.").start();try{let o=h.join(Q.tmpdir(),`shadcn-template-${Date.now()}`);await l.ensureDir(o);let n=await fetch(X);if(!n.ok)throw new Error(`Failed to download template: ${n.statusText}`);let a=h.resolve(o,"template.tar.gz");await l.writeFile(a,Buffer.from(await n.arrayBuffer())),await execa("tar",["-xzf",a,"-C",o,"--strip-components=2","ui-main/templates/vite-app"]);let p=h.resolve(o,"vite-app");if(await l.move(p,e),await l.remove(o),t.packageManager!=="pnpm"){let m=h.join(e,"pnpm-lock.yaml");l.existsSync(m)&&await l.remove(m);}await execa(t.packageManager,["install"],{cwd:e});let c=h.join(e,"package.json");if(l.existsSync(c)){let m=await l.readFile(c,"utf8"),O=JSON.parse(m);O.name=e.split("/").pop(),await l.writeFile(c,JSON.stringify(O,null,2));}await execa("git",["--version"],{cwd:e}),await execa("git",["init"],{cwd:e}),await execa("git",["add","-A"],{cwd:e}),await execa("git",["commit","-m","Initial commit"],{cwd:e}),r?.succeed("Creating a new Vite project.");}catch{r?.fail("Something went wrong creating a new Vite project.");}}async function C(e){e={srcDir:false,...e};let t="vite",r="my-app",{type:o,name:n}=await te([{type:"select",name:"type",message:`The path ${s.info(e.cwd)} does not contain a package.json file.
   Would you like to start a new vite project?`,choices:[{title:"Yes, create a new vite project",value:"vite"},{title:"No, exit and create a project manually",value:"exit"}],initial:0},{type:e.name?null:"text",name:"name",message:"What is your project named?",initial:r,format:c=>c.trim(),validate:c=>c.length>128?"Name should be less than 128 characters.":true}]);t=o??t,r=n??r;let a=await M(e.cwd,{withFallback:true}),p=`${e.cwd}/${r}`;try{await l.access(e.cwd,l.constants.W_OK);}catch{i.break(),i.error(`The path ${s.info(e.cwd)} is not writable.`),i.error(`It is likely you don't have permissions for this folder or the paths ${s.info(e.cwd)} does not exist.`),i.break(),process.exit(1);}return l.existsSync(h.resolve(e.cwd,r,"package.json"))&&(i.break(),i.error(`A project with the name ${s.info(r)} already exists.`),i.error("Please choose a different name and try again."),i.break(),process.exit(1)),await v(p,{packageManager:a}),{projectPath:p,projectName:r,template:t}}async function D(e=process.cwd()){try{let{config:t}=await import('@dotenvx/dotenvx'),r=[".env.local",".env.development.local",".env.development",".env"];for(let o of r){let n=join(e,o);existsSync(n)&&t({path:n,overload:!1,quiet:!0});}}catch(t){i.warn("Failed to load env files:",t);}}process.on("exit",e=>{let t=h.resolve(process.cwd(),"uidesu.config.json");e===0&&i.info("\u2713 uidesu initialized successfully!"),i.info(`Configuration file created at:
${t}`);});var ne=z.object({cwd:z.string(),name:z.string().optional(),yes:z.boolean(),srcDir:z.boolean().optional()}),$=new Command().name("init").description("initialize a uidesu in your project.").option("-y, --yes","skip prompts and use default values",false).option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).option("--src-dir","use the src directory when creating a new project.",false).action(async e=>{try{let t=ne.parse({cwd:h.resolve(e.cwd),...e});await D(t.cwd),await se(t),i.success(`Initialized uidesu in directory: ${e.cwd}`),i.break();}catch{i.break();}});async function se(e){let o=await F(e);if(i.info(`Preflight checks completed.
`),o.errors["1"]){let{projectPath:n,template:a}=await C(e);n||process.exit(1),e.cwd=n,await g(e.cwd);}else await g(e.cwd);}process.on("SIGNINT",()=>process.exit(0));process.on("SIGTERM",()=>process.exit(0));async function ce(){let e=new Command().name("uidesu").description("add items from registry to your project").version(S.version,"-v, --version","display the version number");e.addCommand($).addCommand(E),e.parse();}ce();//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map