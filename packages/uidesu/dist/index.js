#!/usr/bin/env node
import {p,q,j as j$1,u as u$1,g as g$1}from'./chunk-2IEF2V43.js';import {Command}from'commander';import x from'fs-extra';import v,{join}from'path';import Ut from'prompts';import g,{z as z$1}from'zod';import {cosmiconfig}from'cosmiconfig';import {loadConfig,createMatchPath}from'tsconfig-paths';import {green,cyan,yellow,red}from'kleur/colors';import K from'fast-glob';import wt from'ora';import Et from'deepmerge';import {existsSync,promises}from'fs';import {HttpsProxyAgent}from'https-proxy-agent';import Pt from'node-fetch';import Dt,{homedir}from'os';import {detect}from'@antfu/ni';import {execa}from'execa';var Re={version:"1.0.0"};var L={"next-app":{name:"next-app",label:"Next.js",links:{installation:"https://ui.aodesu.com/docs/installation/next",tailwind:"https://tailwindcss.com/docs/guides/nextjs"}},"next-pages":{name:"next-pages",label:"Next.js",links:{installation:"https://ui.aodesu.com/docs/installation/next",tailwind:"https://tailwindcss.com/docs/guides/nextjs"}},vite:{name:"vite",label:"vite",links:{installation:"https://ui.aodesu.com/docs/installation/vite",tailwind:"https://tailwindcss.com/docs/guides/vite"}},manual:{name:"manual",label:"Manual",links:{installation:"https://ui.aodesu.com/docs/installation/manual",tailwind:"https://tailwindcss.com/docs/installation"}}};var D=process.env.REGISTRY_URL??"https://ui.aodesu.com/r",Y="aodesu",be=[{name:"neutral",label:"Neutral"}],u={"@uidesu":`${D}/styles/{style}/{name}.json`};var m={error:red,warn:yellow,info:cyan,success:green};async function b(e,t){return createMatchPath(t.absoluteBaseUrl,t.paths)(e,void 0,()=>true,[".ts",".tsx",".jsx",".js",".css"])}var ct=cosmiconfig("components",{searchPlaces:["components.json"]});async function M(e){let t=await lt(e);return t?(t.iconLibrary||(t.iconLibrary=t.style==="aodesu"?"radix":"lucide"),await ce(e,t)):null}async function ce(e,t){t.registries={...u,...t.registries||{}};let r=await loadConfig(e);if(r.resultType==="failed")throw new Error(`Failed to load ${t.tsx?"tsconfig":"jsconfig"}.json ${r.message??""}`.trim());return q.parse({...t,resolvedPaths:{cwd:e,tailwindConfig:t.tailwind.config?v.resolve(e,t.tailwind.config):"",tailwindCss:v.resolve(e,t.tailwind.css),utils:await b(t.aliases.utils,r),components:await b(t.aliases.components,r),ui:t.aliases.ui?await b(t.aliases.ui,r):v.resolve(await b(t.aliases.components,r)??e,"ui"),lib:t.aliases.lib?await b(t.aliases.lib,r):v.resolve(await b(t.aliases.utils,r)??e,".."),hooks:t.aliases.hooks?await b(t.aliases.hooks,r):v.resolve(await b(t.aliases.components,r)??e,"..","hooks")}})}async function lt(e){try{let t=await ct.search(e);if(!t)return null;let r=p.parse(t.config);if(r.registries){for(let n of Object.keys(r.registries))if(n in u)throw new Error(`"${n}" is a built-in registry and cannot be overriden.`)}return r}catch(t){let r=`${e}/components.json`;throw t instanceof Error&&t.message.includes("reserved registry")?t:new Error(`Invalid configuration found in ${m.info(r)}`)}}function Ee(e){let t={resolvedPaths:{cwd:process.cwd(),tailwindConfig:"",tailwindCss:"",utils:"",components:"",ui:"",lib:"",hooks:""},style:"",tailwind:{config:"",css:"",baseColor:"",cssVariables:false},rsc:false,tsx:true,aliases:{components:"",utils:""},registries:{...u}};return e?{...t,...e,resolvedPaths:{...t.resolvedPaths,...e.resolvedPaths||{}},tailwind:{...t.tailwind,...e.tailwind||{}},aliases:{...t.aliases,...e.aliases||{}},registries:{...t.registries,...e.registries||{}}}:t}function le(e="",t=true){let r=v.join(e,"package.json");return x.readJSONSync(r,{throws:t})}var Z=["**/node_modules/**",".next","public","dist","build"];z$1.object({compilerOptions:z$1.object({paths:z$1.record(z$1.string().or(z$1.array(z$1.string())))})});async function N(e){let[t,r,n,o,s,c,a,l]=await Promise.all([K.glob("**/{vite,app}.config.*|gatsby-config.*|composer.json|react-router.config.*",{cwd:e,deep:3,ignore:Z}),x.pathExists(v.resolve(e,"src")),yt(e),dt(e),gt(e),Ce(e),ht(e),le(e,false)]),f=await x.pathExists(v.resolve(e,`${r?"src/":""}app`)),p={framework:L.manual,isSrcDir:r,isRSC:false,isTsx:n,tailwindConfigFile:o,tailwindCssFile:s,tailwindVersion:c,frameworkVersion:null,aliasPrefix:a};return t.find(A=>A.startsWith("next.config."))?.length?(p.framework=f?L["next-app"]:L["next-pages"],p.isRSC=f,p.frameworkVersion=await ut(p.framework,l),p):(t.find(A=>A.startsWith("vite.config."))?.length&&(p.framework=L.vite),p)}async function ut(e,t){if(!t||!["next-app","next-pages"].includes(e.name))return null;let r=t.dependencies?.next||t.devDependencies?.next;if(!r)return null;let n=r.match(/^[\^~]?(\d+\.\d+\.\d+)/);if(n)return n[1];let o=r.match(/(\d+\.\d+\.\d+)/);return o?o[1]:r}async function Ce(e){let[t,r]=await Promise.all([le(e,false),M(e)]);return r?.tailwind?.config===""?"v4":!t?.dependencies?.tailwindcss&&!t?.devDependencies?.tailwindcss?null:/^(?:\^|~)?3(?:\.\d+)*(?:-.*)?$/.test(t?.dependencies?.tailwindcss||t?.devDependencies?.tailwindcss||"")?"v3":"v4"}async function gt(e){let[t,r]=await Promise.all([K.glob(["**/*.css","**/*.scss"],{cwd:e,deep:5,ignore:Z}),Ce(e)]);if(!t.length)return null;for(let n of t){let o=await x.readFile(v.resolve(e,n),"utf8");if(o.includes('@import "tailwindcss"')||o.includes("@import 'tailwindcss'")||o.includes("@tailwind base"))return n}return null}async function dt(e){let t=await K.glob("tailwind.config.*",{cwd:e,deep:3,ignore:Z});return t.length?t[0]:null}async function ht(e){let t=await loadConfig(e);if(t?.resultType==="failed"||!Object.entries(t?.paths).length)return null;for(let[r,n]of Object.entries(t.paths))if(n.includes("./*")||n.includes("./src/*")||n.includes("./app/*")||n.includes("./resources/js/*"))return r.replace(/\/\*$/,"")??null;return Object.keys(t?.paths)?.[0].replace(/\/\*$/,"")??null}async function yt(e){return (await K.glob("tsconfig.*",{cwd:e,deep:1,ignore:Z})).length>0}async function Se(e,t=null){let[r,n]=await Promise.all([M(e),t?Promise.resolve(t):N(e)]);if(r)return r;if(!n||!n.tailwindCssFile||n.tailwindVersion==="v3"&&!n.tailwindConfigFile)return null;let o={$schema:"https://ui.shadcn.com/schema.json",rsc:n.isRSC,tsx:n.isTsx,style:"new-york",tailwind:{config:n.tailwindConfigFile??"",baseColor:"zinc",css:n.tailwindCssFile,cssVariables:true,prefix:""},iconLibrary:"lucide",aliases:{components:`${n.aliasPrefix}/components`,ui:`${n.aliasPrefix}/components/ui`,hooks:`${n.aliasPrefix}/hooks`,lib:`${n.aliasPrefix}/lib`,utils:`${n.aliasPrefix}/lib/utils`}};return await ce(e,o)}async function Ie(e){if(!e.resolvedPaths?.cwd)return "v3";let t=await N(e.resolvedPaths.cwd);return t?.tailwindVersion?t.tailwindVersion:null}var i={error(...e){console.log(m.error(e.join(" ")));},warn(...e){console.log(m.warn(e.join(" ")));},info(...e){console.log(m.info(e.join(" ")));},success(...e){console.log(m.success(e.join(" ")));},log(...e){console.log(e.join(" "));},break(){console.log("");}};function h(e,t){return wt({text:e,isSilent:t?.silent})}async function Oe(e){let t={};if(!x.existsSync(e.cwd)||!x.existsSync(v.resolve(e.cwd,"package.json")))return t["1"]=true,{errors:t,projectInfo:null};let r=h("Preflight checks.",{silent:e.silent}).start();x.existsSync(v.resolve(e.cwd,"components.json"))&&!e.force&&(r?.fail(),i.break(),i.error(`A ${m.info("components.json")} file already exist at ${m.info(e.cwd)}. 
To start over, remove the ${m.info("components.json")} file and run ${m.info("init")} again.`),i.break(),process.exit(1)),r?.succeed();let n=h("Verifying framework.",{silent:e.silent}).start(),o=await N(e.cwd);(!o||o?.framework.name==="manual")&&(t["7"]=true,n?.fail(),i.break(),o?.framework.links.installation&&i.error(`We could not detect a supported framework at ${m.info(e.cwd)}.
Visit ${m.info(o?.framework.links.installation)} to manually configure your project. 
Once configured, you can use the cli to add components.`),i.break(),process.exit(1)),n?.succeed(`Verifying framework. Found ${m.info(o.framework.label)}.`);let s="Validating Tailwind CSS.";o.tailwindVersion==="v4"&&(s=`Validating Tailwind CSS config. Found ${m.info("v4")}.`);let c=h(s,{silent:e.silent}).start();o.tailwindVersion==="v3"&&(!o?.tailwindConfigFile||!o?.tailwindCssFile)?(t["5"]=true,c?.fail()):o.tailwindVersion==="v4"&&!o?.tailwindCssFile?(t["5"]=true,c?.fail()):o.tailwindVersion?c?.succeed():(t["5"]=true,c?.fail());let a=h("Validating import alias.",{silent:e.silent}).start();return o?.aliasPrefix?a?.succeed():(t["6"]=true,a?.fail()),Object.keys(t).length>0&&(t["5"]&&(i.break(),i.error(`No Tailwind CSS configuration found at ${m.info(e.cwd)}.`),i.error("It is likely you do not have Tailwind CSS installed or have an invalid configuration."),i.error("Install Tailwind CSS then try again."),o?.framework.links.tailwind&&i.error(`Visit ${m.info(o?.framework.links.tailwind)} to get started.`)),t["6"]&&(i.break(),i.error("No import alias found in your tsconfig.json file."),o?.framework.links.installation&&i.error(`Visit ${m.info(o?.framework.links.installation)} to learn how to set an import alias.`)),i.break(),process.exit(1)),{errors:t,projectInfo:o}}var R={NOT_FOUND:"NOT_FOUND",UNAUTHORIZED:"UNAUTHORIZED",FORBIDDEN:"FORBIDDEN",FETCH_ERROR:"FETCH_ERROR",NOT_CONFIGURED:"NOT_CONFIGURED",MISSING_ENV_VARS:"MISSING_ENV_VARS",LOCAL_FILE_ERROR:"LOCAL_FILE_ERROR",PARSE_ERROR:"PARSE_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR"},d=class extends Error{code;statusCode;context;suggestion;timestamp;cause;constructor(t,r={}){super(t),this.name="RegistryError",this.code=r.code||R.UNKNOWN_ERROR,this.statusCode=r.statusCode,this.cause=r.cause,this.context=r.context,this.suggestion=r.suggestion,this.timestamp=new Date,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);}toJSON(){return {name:this.name,message:this.message,code:this.code,statusCode:this.statusCode,context:this.context,suggestion:this.suggestion,timestamp:this.timestamp,stack:this.stack}}},V=class extends d{constructor(r,n){let o=`The item at ${r} was not found. It may not exist at the registry.`;super(o,{code:R.NOT_FOUND,statusCode:404,cause:n,context:{url:r},suggestion:"Check if the item name is correct and the registry URL is accessible."});this.url=r;this.name="RegistryNotFoundError";}},Q=class extends d{constructor(r,n){let o=`You are not authorized to access the item at ${r}. If this is a remote registry, you may need to authenticate.`;super(o,{code:R.UNAUTHORIZED,statusCode:401,cause:n,context:{url:r},suggestion:"Check your authentication credentials and environment variables."});this.url=r;this.name="RegistryUnauthorizedError";}},X=class extends d{constructor(r,n){let o=`You are not authorized to access the item at ${r}. If this is a remote registry, you may need to authenticate.`;super(o,{code:R.FORBIDDEN,statusCode:403,cause:n,context:{url:r},suggestion:"Check your authentication credentials and environment variables."});this.url=r;this.name="RegistryForbiddenError";}},ee=class extends d{constructor(r,n,o,s){let c=n?`Failed to fetch from registry (${n}): ${r}`:`Failed to fetch from registry: ${r}`,a=typeof s=="string"&&s?`${c} - ${s}`:c,l="Check your network connection and try again.";n===404?l="The requested resource was not found. Check the URL or item name.":n===500?l="The registry server encountered an error. Try again later.":n&&n>=400&&n<500&&(l="There was a client error. Check your request parameters.");super(a,{code:R.FETCH_ERROR,statusCode:n,cause:s,context:{url:r,responseBody:o},suggestion:l});this.url=r;this.responseBody=o;this.name="RegistryFetchError";}},T=class extends d{constructor(r){let n=r?`Unknown registry "${r}". Make sure it is defined in components.json as follows:
{
  "registries": {
    "${r}": "[URL_TO_REGISTRY]"
  }
}`:'Unknown registry. Make sure it is defined in components.json under "registries".';super(n,{code:R.NOT_CONFIGURED,context:{registryName:r},suggestion:"Add the registry configuration to your components.json file. Consult the registry documentation for the correct format."});this.registryName=r;this.name="RegistryNotConfiguredError";}},W=class extends d{constructor(r,n){super(`Failed to read local registry file: ${r}`,{code:R.LOCAL_FILE_ERROR,cause:n,context:{filePath:r},suggestion:"Check if the file exists and you have read permissions."});this.filePath=r;this.name="RegistryLocalFileError";}},w=class extends d{constructor(r,n){let o=`Failed to parse registry item: ${r}`;n instanceof z$1.ZodError&&(o=`Failed to parse registry item: ${r}
${n.errors.map(s=>`  - ${s.path.join(".")}: ${s.message}`).join(`
`)}`);super(o,{code:R.PARSE_ERROR,cause:n,context:{item:r},suggestion:"The registry item may be corrupted or have an invalid format. Please make sure it returns a valid JSON object. See https://ui.shadcn.com/schema/registry-item.json."});this.item=r;this.parseError=n,this.name="RegistryParseError";}parseError},te=class extends d{constructor(r,n){let o=`Registry "${r}" requires the following environment variables:

`+n.map(s=>`  \u2022 ${s}`).join(`
`);super(o,{code:R.MISSING_ENV_VARS,context:{registryName:r,missingVars:n},suggestion:"Set the required environment variables to your .env or .env.local file."});this.registryName=r;this.missingVars=n;this.name="RegistryMissingEnvironmentVariablesError";}};var re=class extends d{parseError;constructor(t){let r="Failed to parse registries index";if(t instanceof z$1.ZodError){let n=t.errors.filter(o=>o.path.length>0).map(o=>`"${o.path[0]}"`).filter((o,s,c)=>c.indexOf(o)===s);n.length>0?r=`Failed to parse registries index. Invalid registry namespace(s): ${n.join(", ")}
${t.errors.map(o=>`  - ${o.path.join(".")}: ${o.message}`).join(`
`)}`:r=`Failed to parse registries index:
${t.errors.map(o=>`  - ${o.path.join(".")}: ${o.message}`).join(`
`)}`;}super(r,{code:R.PARSE_ERROR,cause:t,context:{parseError:t},suggestion:"The registries index may be corrupted or have invalid registry namespace format. Registry names must start with @ (e.g., @shadcn, @example)."}),this.parseError=t,this.name="RegistriesIndexParseError";}};function C(e){if(i.break(),i.error("Something went wrong. Please check the error below for more details."),i.error("If the problem persist, please open an issue on GitHub."),i.error(""),typeof e=="string"&&(i.error(e),i.break(),process.exit(1)),e instanceof d&&(e.message&&(i.error(e.cause?"Error":"Message:"),i.error(e.message)),e.cause&&(i.error(`
Message:`),i.error(e.cause)),e.suggestion&&(i.error(`
Suggestion:`),i.error(e.suggestion)),i.break(),process.exit(1)),e instanceof g.ZodError){i.error("Validation failed:");for(let[t,r]of Object.entries(e.flatten().fieldErrors))i.error(`- ${m.info(t)}: ${r}`);i.break(),process.exit(1);}e instanceof Error&&(i.error(e.message),i.break(),process.exit(1)),i.break(),process.exit(1);}function G(e){return e.replace(/\${(\w+)}/g,(t,r)=>process.env[r]||"")}function z(e){let t=[],r=/\${(\w+)}/g,n;for(;(n=r.exec(e))!==null;)t.push(n[1]);return t}var bt=/^(@[a-zA-Z0-9](?:[a-zA-Z0-9-_]*[a-zA-Z0-9])?)\/(.+)$/;function j(e){if(!e.startsWith("@"))return {registry:null,item:e};let t=e.match(bt);return t?{registry:t[1],item:t[2]}:{registry:null,item:e}}function P(e){try{return new URL(e),!0}catch{return  false}}function Te(e){return e.endsWith(".json")&&!P(e)}function Ct(e){return e.style?e.style==="aodesu"&&e.tailwind?.config===""?Y:e.style:Y}function _(e){let t=Ee({style:Y,registries:u});return e?q.parse(Et(t,{...e,style:Ct(e),registries:{...u,...e.registries}})):t}var ne={headers:{}};function oe(e){ne.headers={...ne.headers,...e};}function je(e){return ne.headers[e]||{}}function B(){ne.headers={};}function St(e){let t=new Set;return typeof e=="string"?z(e).forEach(r=>t.add(r)):(z(e.url).forEach(r=>t.add(r)),e.params&&Object.values(e.params).forEach(r=>{z(r).forEach(n=>t.add(n));}),e.headers&&Object.values(e.headers).forEach(r=>{z(r).forEach(n=>t.add(n));})),Array.from(t)}function Pe(e,t){let n=St(t).filter(o=>!process.env[o]);if(n.length>0)throw new te(e,n)}var _e="{name}",se="{style}",Fe=/\${(\w+)}/g,$e="?",It="&";function F(e,t){let{registry:r,item:n}=j(e);if(!r)return null;let s=(t?.registries||{})[r];if(!s)throw new T(r);return Pe(r,s),{url:vt(n,s,t),headers:kt(s)}}function vt(e,t,r){if(typeof t=="string"){let o=t.replace(_e,e);return r?.style&&o.includes(se)&&(o=o.replace(se,r.style)),G(o)}let n=t.url.replace(_e,e);return r?.style&&n.includes(se)&&(n=n.replace(se,r.style)),n=G(n),t.params?Ot(n,t.params):n}function kt(e){if(typeof e=="string"||!e.headers)return {};let t={};for(let[r,n]of Object.entries(e.headers)){let o=G(n);Nt(n,o)&&(t[r]=o);}return t}function Ot(e,t){let r=new URLSearchParams;for(let[s,c]of Object.entries(t)){let a=G(c);a&&r.append(s,a);}let n=r.toString();if(!n)return e;let o=e.includes($e)?It:$e;return `${e}${o}${n}`}function Nt(e,t){let r=t.trim();if(!r)return  false;if(e.includes("${")&&e.match(Fe)){let o=e.replace(Fe,"").trim();return r!==o}return  true}function Ae(e){if(P(e)){let t=new URL(e);return t.pathname.match(/\/chat\/b\//)&&!t.pathname.endsWith("/json")&&(t.pathname=`${t.pathname}/json`),t.toString()}return `${D}/${e}`}var Ft=process.env.https_proxy?new HttpsProxyAgent(process.env.https_proxy):void 0,ge=new Map;async function E(e,t={}){t={useCache:true,...t};try{return await Promise.all(e.map(async n=>{let o=Ae(n);if(t.useCache&&ge.has(o))return ge.get(o);let s=(async()=>{let c=je(o),a=await Pt(o,{agent:Ft,headers:{...c}});if(!a.ok){let l;if(a.headers.get("content-type")?.includes("application/json")){let f=await a.json(),p=z$1.object({detail:z$1.string().optional(),title:z$1.string().optional(),message:z$1.string().optional(),error:z$1.string().optional()}).safeParse(f);p.success&&(l=p.data.detail||p.data.message,p.data.error&&(l=`[${p.data.error}] ${l}`));}throw a.status===401?new Q(o,l):a.status===404?new V(o,l):a.status===403?new X(o,l):new ee(o,a.status,l)}return a.json()})();return t.useCache&&ge.set(o,s),s}))}catch(r){throw r}}async function De(e){try{let t=e;e.startsWith("~/")&&(t=v.join(homedir(),e.slice(2)));let r=v.resolve(t),n=await promises.readFile(r,"utf8"),o=JSON.parse(n);try{return g$1.parse(o)}catch(s){throw new w(e,s)}}catch(t){throw t instanceof Error&&(t.message.includes("ENOENT")||t.message.includes("no such file"))?new W(e,t):t instanceof w?t:new W(e,t)}}function $t(e,t){let r={},n=[...e];if(!t?.registries)return oe({}),n;for(let o=0;o<n.length;o++){let s=F(n[o],t);s&&(n[o]=s.url,Object.keys(s.headers).length>0&&(r[s.url]=s.headers));}return oe(r),n}async function ie(e,t,r={}){return await Promise.all(e.map(async o=>{if(Te(o))return De(o);if(P(o)){let[a]=await E([o],r);try{return g$1.parse(a)}catch(l){throw new w(o,l)}}if(o.startsWith("@")&&t?.registries){let a=$t([o],t),[l]=await E(a,r);try{return g$1.parse(l)}catch(f){throw new w(o,f)}}let s=`styles/${t?.style??"aodesu"}/${o}.json`,[c]=await E([s],r);console.log("TEST - LLEGO AKI");try{return g$1.parse(c)}catch(a){throw new w(o,a)}}))}async function Ue(e,t){let{config:r,useCache:n}=t||{};return B(),ie(e,_(r),{useCache:n})}async function Me(){try{let[e]=await E(["styles/index.json"]);return j$1.parse(e)}catch(e){return i.error(`
`),C(e),[]}}async function Ve(){return be}async function We(e){e={useCache:true,...e};let t=`${D}/registries.json`,[r]=await E([t],{useCache:e.useCache});try{return u$1.parse(r)}catch(n){throw n instanceof g.ZodError?new re(n):n}}async function Ge(e,{withFallback:t}={withFallback:false}){let r=await detect({programmatic:true,cwd:e});if(r==="yarn@berry")return "yarn";if(r==="pnpm@6")return "pnpm";if(r==="bun")return "bun";if(r==="deno")return "deno";if(!t)return r??"npm";let n=process.env.npm_config_user_agent||"";return n.startsWith("yarn")?"yarn":n.startsWith("pnpm")?"pnpm":n.startsWith("bun")?"bun":"npm"}var Mt="https://codeload.github.com/shadcn-ui/ui/tar.gz/main",I={next:"next","next-16":"next-16","next-monorepo":"next-monorepo",vite:"vite"};async function ze(e){e={srcDir:false,...e};let t=e.template&&I[e.template]?e.template:"next",r=t===I.next?"my-app":"my-monorepo",n="15",o=e.components?.length===1&&!!e.components[0].match(/\/chat\/b\//);if(e.components&&o)try{let[a]=await E(e.components),{meta:l}=g.object({meta:g.object({nextVersion:g.string()})}).parse(a);n=l.nextVersion,t=I.next;}catch(a){i.break(),C(a);}if(!e.force){let{type:a,name:l}=await Ut([{type:e.template||o?null:"select",name:"type",message:`The path ${m.info(e.cwd)} does not contain a package.json file.
  Would you like to start a new project?`,choices:[{title:"Vite",value:"vite"},{title:"Next.js 15",value:"next"},{title:"Next.js 16",value:"next-16"},{title:"Next.js (Monorepo)",value:"next-monorepo"}],initial:0},{type:"text",name:"name",message:"What is your project named?",initial:r,format:f=>f.trim(),validate:f=>f.length>128?"Name should be less than 128 characters.":true}]);t=a??t,r=l,a==="next-16"&&(n="latest");}let s=await Ge(e.cwd,{withFallback:true}),c=`${e.cwd}/${r}`;try{await x.access(e.cwd,x.constants.W_OK);}catch{i.break(),i.error(`The path ${m.info(e.cwd)} is not writable.`),i.error(`It is likely you do not have write permissions for this folder or the path ${m.info(e.cwd)} does not exist.`),i.break(),process.exit(1);}return x.existsSync(v.resolve(e.cwd,r,"package.json"))&&(i.break(),i.error(`A project with the name ${m.info(r)} already exists.`),i.error("Please choose a different name and try again."),i.break(),process.exit(1)),t===I.vite&&await Vt(c,{packageManager:s}),(t===I.next||t===I["next-16"])&&await Wt(c,{version:n,cwd:e.cwd,packageManager:s,srcDir:!!e.srcDir}),t===I["next-monorepo"]&&await Gt(c,{packageManager:s}),{projectPath:c,projectName:r,template:t}}async function Vt(e,t){let r=h("Creating a new Vite project. This may take a few minutes.").start();try{let n=["create","vite@latest",v.basename(e),"--template","react-ts","--yes"];await execa(t.packageManager,n,{cwd:v.dirname(e)});let o=h(`Installing dependencies with ${t.packageManager}.`).start();await execa(t.packageManager,["install"],{cwd:e}),o?.succeed(`Installed dependencies with ${t.packageManager}.`);try{await execa("git",["init"],{cwd:e}),await execa("git",["add","-A"],{cwd:e}),await execa("git",["commit","-m","Initial commit from shadcn-ui"],{cwd:e});}catch{i.warn("Git initialization skipped (git not available)");}r?.succeed("Creating a new Vite project.");}catch(n){r?.fail("Something went worng creating a new Vite project."),C(n);}}async function Wt(e,t){let r=h(`Creating a new Next.js ${t.version.startsWith("latest")?"16":"15"} project. This may take a few minutes.`).start(),n=["--tailwind","--eslint","--typescript","--app",t.srcDir?"--src-dir":"--no-src-dir","--no-import-alias",`--use-${t.packageManager}`];(t.version.startsWith("15")||t.version.startsWith("latest")||t.version.startsWith("canary"))&&n.push("--turbopack"),(t.version.startsWith("latest")||t.version.startsWith("canary"))&&n.push("--no-react-compiler");try{await execa("npx",[`create-next-app@${t.version}`,e,"--silent",...n],{cwd:t.cwd});}catch{i.break(),i.error("Something went wrong creating a new Next.js project. Please try again."),process.exit(1);}r?.succeed(`Creating a new Next.js ${t.version.startsWith("latest")?"16":"15"} project.`);}async function Gt(e,t){let r=h("Creating a new Next.js monorepo. This may take a few minutes.").start();try{let n=v.join(Dt.tmpdir(),`shadcn-template-${Date.now()}`);await x.ensureDir(n);let o=await fetch(Mt);if(!o.ok)throw new Error(`Failed to download template: ${o.statusText}`);let s=v.resolve(n,"template.tar.gz");await x.writeFile(s,Buffer.from(await o.arrayBuffer())),await execa("tar",["-xzf",s,"-C",n,"--strip-components=2","ui-main/templates/monorepo-next"]);let c=v.resolve(n,"monorepo-next");await x.move(c,e),await x.remove(n),await execa(t.packageManager,["install"],{cwd:e});let a=v.join(e,"package.json");if(x.existsSync(a)){let f=await x.readFile(a,"utf8"),p=JSON.parse(f);p.name=e.split("/").pop(),await x.writeFile(a,JSON.stringify(p,null,2));}let l=process.cwd();await execa("git",["--version"],{cwd:e}),await execa("git",["init"],{cwd:e}),await execa("git",["add","-A"],{cwd:e}),await execa("git",["commit","-m","Initial commit"],{cwd:e}),r?.succeed("Creating a new Next.js monorepo.");}catch(n){r?.fail("Something went wrong creating a new Next.js monorepo."),C(n);}}async function Be(e=process.cwd()){try{let{config:t}=await import('@dotenvx/dotenvx'),r=[".env.local",".env.development.local",".env.development",".env"];for(let n of r){let o=join(e,n);existsSync(o)&&t({path:o,overload:!1,quiet:!0});}}catch(t){i.warn("Failed to load env files:",t);}}var he=".bak";function He(e){if(!x.existsSync(e))return null;let t=`${e}${he}`;try{return x.renameSync(e,t),t}catch(r){return console.error(`Failed to create backup of ${e}: ${r}`),null}}function Je(e){let t=`${e}${he}`;if(!x.existsSync(t))return  false;try{return x.renameSync(t,e),!0}catch(r){return console.error(`Warning: Could not restore backup file ${t}: ${r}`),false}}function Ye(e){let t=`${e}${he}`;if(!x.existsSync(t))return  false;try{return x.unlinkSync(t),!0}catch{return  false}}async function Ke(e,t){let r=new Set,n=new Set,o=[...e];for(;o.length>0;){let s=o.shift();if(n.has(s))continue;n.add(s);let{registry:c}=j(s);c&&!u[c]&&r.add(c);try{let[a]=await ie([s],t,{useCache:!0});if(a?.registryDependencies)for(let l of a.registryDependencies){let{registry:f}=j(l);f&&!u[f]&&r.add(f),n.has(l)||o.push(l);}}catch(a){if(a instanceof T){let{registry:l}=j(s);l&&!u[l]&&r.add(l);continue}continue}}return Array.from(r)}async function Ze(e,t,r={}){r={silent:false,writeFile:true,...r};let o=(await Ke(e,t)).filter(f=>!t.registries?.[f]&&!Object.keys(u).includes(f));if(o.length===0)return {config:t,newRegistries:[]};let s=await We({useCache:process.env.NODE_ENV!=="development"});if(!s)return {config:t,newRegistries:[]};let c={};for(let f of o)s[f]&&(c[f]=s[f]);if(Object.keys(c).length===0)return {config:t,newRegistries:[]};let a=Object.fromEntries(Object.entries(t.registries||{}).filter(([f])=>!Object.keys(u).includes(f))),l={...t,registries:{...a,...c}};if(r.writeFile){let{resolvedPaths:f,...p$1}=l,A=h("Updating components.json.",{silent:r.silent}).start(),Xe=p.parse(p$1);await x.writeFile(v.resolve(t.resolvedPaths.cwd,"components.json"),JSON.stringify(Xe,null,2)+`
`,"utf-8"),A.succeed();}return {config:l,newRegistries:Object.keys(c)}}process.on("exit",e=>{let t=v.resolve(process.cwd(),"components.json");return e===0?Ye(t):Je(t)});var Zt=g.object({cwd:g.string(),components:g.array(g.string()).optional(),yes:g.boolean(),defaults:g.boolean(),force:g.boolean(),silent:g.boolean(),isNewProject:g.boolean(),srcDir:g.boolean().optional(),cssVariables:g.boolean(),template:g.string().optional().refine(e=>e?"TEMPLATES":true,{message:"Invalid template. Please use 'next', 'next-16' or 'next-monorepo'."}),baseColor:g.string().optional(),baseStyle:g.boolean()}),Qe=new Command().name("init").description("initialize your project and install dependencies").argument("[components...]","names, url or local path to component").option("-t, --template <template>","the template to use. (next, next-16, next-monorepo)").option("-b, --base-color <base-color>","The base color to use. (neutral)",void 0).option("-y, --yes","Skip de confirmation prompt",true).option("-d, --defaults","Use default configuration.",false).option("-f, --force","Force overwrite of existing configuration",false).option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).option("-s, --silent","Mute output",false).option("--src-dir","Use the src directory when creating a new project.",false).option("--no-src-dir","Do not use the src directory when creating a new project.").option("--css-variables","Use css variables for theming.",true).option("--no-base-style","Do not install the base aodesu style.").action(async(e,t)=>{try{t.defaults&&(t.template=t.template||"next",t.baseColor=t.baseColor||"neutral");let r=Zt.parse({cwd:v.resolve(t.cwd),isNewProject:!1,components:e,...t});if(await Be(r.cwd),e.length>0){let n=_({}),o=v.resolve(r.cwd,"components.json");if(x.existsSync(o)){let a=await x.readJson(o),l=p.partial().parse(a);n=_(l),He(o);}let{config:s}=await Ze(e,n,{silent:!0});n=s,F(e[0],n);let[c]=await Ue([e[0]],{config:n});console.log("TEST - LLEGO AKI"),c?.type=="registry:style"&&(r.baseColor="neutral",r.baseStyle=c.extends==="none"?!1:r.baseStyle);}r.baseStyle||(r.baseColor="neutral"),await qt(r),i.log(`${m.success("Success!")} Project initialization completed. 
You may now add components.`);}catch(r){i.break(),C(r);}finally{B();}});async function qt(e){let t,r;if(e.skipPreflight)t=await N(e.cwd);else {let s=await Oe(e);if(s.errors["1"]){let{projectPath:c,template:a}=await ze(e);c||process.exit(1),e.cwd=c,e.isNewProject=true,r=a;}t=s.projectInfo;}if(r==="next-monorepo")return e.cwd=v.resolve(e.cwd,"apps/web"),await M(e.cwd);let n=await Se(e.cwd,t);n?await Qt(n,e):console.log("xd");}async function Qt(e,t){let r=e.style,n=t.baseColor,o=e.tailwind.cssVariables;if(!t.defaults){let[s,c,a]=await Promise.all([Me(),Ve(),Ie(e)]),l=await Ut([{type:a==="v4"?null:"select",name:"style",message:`Which ${m.info("style")} would you like to use?`,choices:s.map(f=>({title:f.name==="aodesu"?"aodesu (Recommended)":f.label,value:f.name})),initial:0},{type:t.baseColor?null:"select",name:"tailwindBaseColor",message:`Which color would you like to use as the ${m.info("base color")}?`,choices:c.map(f=>({title:f.label,value:f.name}))}]);r=l.style??"aodesu",n=l.tailwindBaseColor??n,o=t.cssVariables;}return p.parse({$schema:e?.$schema,style:r,tailwind:{...e?.tailwind,baseColor:n,cssVariables:o},rsc:e?.rsc,tsx:e?.tsx,iconLibrary:e?.iconLibrary,aliases:e?.aliases})}process.on("SIGNINT",()=>process.exit(0));process.on("SIGTERM",()=>process.exit(0));async function er(){let e=new Command().name("uidesu").description("add items from registry to your project").version(Re.version,"-v, --version","display the version number");e.addCommand(Qe),e.parse();}er();//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map