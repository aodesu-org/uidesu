#!/usr/bin/env node
import {g as g$1,m,n,i}from'./chunk-FMM57UT3.js';import {Command}from'commander';import {promises,existsSync}from'fs';import I,{join}from'path';import R,{z}from'zod';import {green,cyan,yellow,red}from'kleur/colors';import {loadConfig,createMatchPath}from'tsconfig-paths';import {cosmiconfig}from'cosmiconfig';import m$1 from'fs-extra';import N from'fast-glob';import ve from'ora';import {detect}from'@antfu/ni';import ne from'prompts';import Pe from'os';import {execa}from'execa';import'deepmerge';var B={version:"1.0.0"};var s={error:red,warn:yellow,info:cyan,success:green};var o={error(...e){console.log(s.error(e.join(" ")));},warn(...e){console.log(s.warn(e.join(" ")));},info(...e){console.log(s.info(e.join(" ")));},success(...e){console.log(s.success(e.join(" ")));},log(...e){console.log(e.join(" "));},break(){console.log("");}};R.object({cwd:R.string(),registryFile:R.string(),outputDir:R.string()});var K=new Command().name("build").description("build components for a aodesu registry").argument("[registry]","path to registry.json file","./registry.json").option("-o, --output <path>","destination directory for json files","./public/r").option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).action(async(e,t)=>{try{let r=I.resolve(t.cwd),i=I.resolve(r,t.output),n=I.resolve(r,e),a=await promises.readFile(n,"utf-8"),f=g$1.parse(JSON.parse(a));await promises.mkdir(i,{recursive:!0});let c=f.items.map(p=>({name:p.name,type:p.type}));await promises.writeFile(I.join(i,"index.json"),JSON.stringify(c,null,2)),o.info(`\u2713 Generated ${c.length} items`),o.info(`\u2713 Output directory: ${i}`);}catch(r){r instanceof R.ZodError?(o.error("Invalid registry.json format"),r.errors.forEach(i=>{o.error(`  ${i.path.join(".")}: ${i.message}`);})):r instanceof Error?o.error(r.message):o.error("Unknown error occurred"),process.exit(1);}});var b={"next-app":{name:"next-app",label:"Next.js",links:{installation:"https://ui.uidesu.com/docs/installation/next",tailwind:"https://tailwindcss.com/docs/guides/nextjs"}},"next-pages":{name:"next-pages",label:"Next.js",links:{installation:"https://ui.uidesu.com/docs/installation/next",tailwind:"https://tailwindcss.com/docs/guides/nextjs"}},vite:{name:"vite",label:"Vite",links:{installation:"https://ui.uidesu.com/docs/installation/vite",tailwind:"https://tailwindcss.com/docs/guides/vite"}},manual:{name:"manual",label:"Manual",links:{installation:"https://ui.uidesu.com/docs/installation/manual",tailwind:"https://tailwindcss.com/docs/installation"}}};async function g(e,t){return createMatchPath(t.absoluteBaseUrl,t.paths)(e,void 0,()=>true,[".ts",".tsx",".jsx",".js",".css"])}var we=process.env.REGISTRY_URL??"https://ui.aodesu.com/r",E={"@shadcn":`${we}/styles/{style}/{name}.json`};var xe=cosmiconfig("uidesu",{searchPlaces:["uidesu.config.json"]});async function O(e){let t=await Re(e);return t?await k(e,t):null}async function k(e,t){t.registries={...E,...t.registries||{}};let r=await loadConfig(e);if(r.resultType==="failed")throw new Error(`Failed to load ${t.tsx?"tsconfig":"jsconfig"}.json. ${r.message??""}`.trim());return n.parse({...t,resolvedPaths:{cwd:e,tailwindConfig:t.tailwind.config?I.resolve(e,t.tailwind.config):"",tailwindCss:I.resolve(e,t.tailwind.css),utils:await g(t.aliases.utils,r),components:await g(t.aliases.components,r),ui:t.aliases.ui?await g(t.aliases.ui,r):I.resolve(await g(t.aliases.components,r)??e,"ui"),lib:t.aliases.lib?await g(t.aliases.lib,r):I.resolve(await g(t.aliases.utils,r)??e,"..")}})}async function Re(e){try{let t=await xe.search(e);if(!t)return null;let r=m.parse(t.config);if(r.registries){for(let i of Object.keys(r.registries))if(i in E)throw new Error(`"${i}" is a built-in registry and cannot be overridden.`)}return r}catch(t){let r=`${e}/uidesu.config.json`;throw t instanceof Error&&t.message.includes("reserved registry")?t:new Error(`Invalid configuration found in ${s.info(r)}.`)}}function D(e="",t=true){let r=I.join(e,"package.json");return m$1.readJSONSync(r,{throws:t})}var P=["**/node_modules/**",".next","public","dist","build"];z.object({compilerOptions:z.object({paths:z.record(z.string().or(z.array(z.string())))})});async function S(e){let[t,r,i,n,a,f,c,p]=await Promise.all([N.glob("**/{next,vite,astro,app}.config.*|gatsby-config.*|composer.json|react-router.config.*",{cwd:e,deep:3,ignore:P}),m$1.pathExists(I.resolve(e,"src")),je(e),Se(e),ke(e),H(e),Ie(e),D(e,false)]),y=await m$1.pathExists(I.resolve(e,`${r?"src/":""}app`)),l={framework:b.manual,isSrcDir:r,isTsx:i,tailwindConfigFile:n,tailwindCssFile:a,tailwindVersion:f,frameworkVersion:null,aliasPrefix:c};return t.find(u=>u.startsWith("next.config."))?.length?(l.framework=y?b["next-app"]:b["next-pages"],l):(t.find(u=>u.startsWith("vite.config."))?.length&&(l.framework=b.vite),l)}async function H(e){let[t,r]=await Promise.all([D(e,false),O(e)]);return r?.tailwind?.config===""?"v4":!t?.dependencies?.tailwindcss&&!t?.devDependencies?.tailwindcss?null:/^(?:\^|~)?3(?:\.\d+)*(?:-.*)?$/.test(t?.dependencies?.tailwindcss||t?.devDependencies?.tailwindcss||"")?"v3":"v4"}async function ke(e){let[t,r]=await Promise.all([N.glob(["**/*.css","**/*.scss"],{cwd:e,deep:5,ignore:P}),H(e)]);if(!t.length)return null;for(let n of t){let a=await m$1.readFile(I.resolve(e,n),"utf8");if(a.includes('@import "tailwindcss"')||a.includes("@import 'tailwindcss'")||a.includes("@tailwind base"))return n}return null}async function Se(e){let t=await N.glob("tailwind.config.*",{cwd:e,deep:3,ignore:P});return t.length?t[0]:null}async function Ie(e){let t=await loadConfig(e);if(t?.resultType==="failed"||!Object.entries(t?.paths).length)return null;for(let[r,i]of Object.entries(t.paths))if(i.includes("./*")||i.includes("./src/*")||i.includes("./app/*")||i.includes("./resources/js/*"))return r.replace(/\/\*$/,"")??null;return Object.keys(t?.paths)?.[0].replace(/\/\*$/,"")??null}async function je(e){return (await N.glob("tsconfig.*",{cwd:e,deep:1,ignore:P})).length>0}async function Z(e,t=null){let[r,i]=await Promise.all([O(e),t?Promise.resolve(t):S(e)]);if(r)return r;if(!i||!i.tailwindCssFile||i.tailwindVersion==="v3"&&!i.tailwindConfigFile)return null;let n={$schema:"https://ui.aodesu.com/schema.json",tsx:i.isTsx,style:"aodesu",tailwind:{config:i.tailwindConfigFile??"",theme:"classic",css:i.tailwindCssFile,cssVariables:true,prefix:""},aliases:{components:`${i.aliasPrefix}/components`,ui:`${i.aliasPrefix}/components/ui`,lib:`${i.aliasPrefix}/lib`,utils:`${i.aliasPrefix}/lib/utils`}};return await k(e,n)}function d(e,t){return ve({text:e,isSilent:t?.silent})}async function Q(e){let t={};if(!m$1.existsSync(e.cwd)||!m$1.existsSync(I.resolve(e.cwd,"package.json")))return t["1"]=true,{errors:t,projectInfo:null};let r=d(" Preflight checks.").start();m$1.existsSync(I.resolve(e.cwd,"uidesu.config.json"))&&(r?.fail(),o.break(),o.error(`A ${s.info("uidesu.config.json")} file already exists at ${s.info(e.cwd)}.
To start over, remove the ${s.info("uidesu.config.json")} file and run ${s.info("uidesu init")} again.`),o.break(),process.exit(1)),r?.succeed();let i=d("Verifying framework.").start(),n=await S(e.cwd);return (!n||n?.framework.name==="manual")&&(t["7"]=true,i?.fail(),o.break(),n?.framework.links.installation&&o.error(`We could not detect a supported framework at ${s.info(e.cwd)}.
Visit ${s.info(n?.framework.links.installation)} to manually configure your project.
Once configured, you can use the cli to add components.`),o.break(),process.exit(1)),i?.succeed(` Verifying framework.
   - Found ${s.info(n.framework.label)}.`),{errors:t,projectInfo:n}}async function L(e,t={}){t={useCache:true,...t};try{return await Promise.all(e.map(async i=>{}))}catch(r){throw r}}async function X(){try{let[e]=await L(["styles/index.json"]);return i.parse(e)}catch{o.error(`
`);}}async function ee(){try{let[e]=await L(["themes/index.json"]);return i.parse(e)}catch{o.error(`
`);}}async function te(e,{withFallback:t}={withFallback:false}){let r=await detect({programmatic:true,cwd:e});if(r==="yarn@berry")return "yarn";if(r==="pnpm@6")return "pnpm";if(r==="bun")return "bun";if(r==="deno")return "deno";if(!t)return r??"npm";let i=process.env.npm_config_user_agent||"";return i.startsWith("yarn")?"yarn":i.startsWith("pnpm")?"pnpm":i.startsWith("bun")?"bun":"npm"}var _e="https://codeload.github.com/shadcn-ui/ui/tar.gz/main";async function V(e,t){let r=d("Creating a new Vite project. This may take a few minutes.").start();try{let i=I.join(Pe.tmpdir(),`shadcn-template-${Date.now()}`);await m$1.ensureDir(i);let n=await fetch(_e);if(!n.ok)throw new Error(`Failed to download template: ${n.statusText}`);let a=I.resolve(i,"template.tar.gz");await m$1.writeFile(a,Buffer.from(await n.arrayBuffer())),await execa("tar",["-xzf",a,"-C",i,"--strip-components=2","ui-main/templates/vite-app"]);let f=I.resolve(i,"vite-app");if(await m$1.move(f,e),await m$1.remove(i),t.packageManager!=="pnpm"){let p=I.join(e,"pnpm-lock.yaml");m$1.existsSync(p)&&await m$1.remove(p);}await execa(t.packageManager,["install"],{cwd:e});let c=I.join(e,"package.json");if(m$1.existsSync(c)){let p=await m$1.readFile(c,"utf8"),y=JSON.parse(p);y.name=e.split("/").pop(),await m$1.writeFile(c,JSON.stringify(y,null,2));}await execa("git",["--version"],{cwd:e}),await execa("git",["init"],{cwd:e}),await execa("git",["add","-A"],{cwd:e}),await execa("git",["commit","-m","Initial commit"],{cwd:e}),r?.succeed("Creating a new Vite project.");}catch{r?.fail("Something went wrong creating a new Vite project.");}}async function re(e){e={srcDir:false,...e};let t="vite",r="my-app",{type:i,name:n}=await ne([{type:"select",name:"type",message:`The path ${s.info(e.cwd)} does not contain a package.json file.
   Would you like to start a new vite project?`,choices:[{title:"Yes, create a new vite project",value:"vite"},{title:"No, exit and create a project manually",value:"exit"}],initial:0},{type:e.name?null:"text",name:"name",message:"What is your project named?",initial:r,format:c=>c.trim(),validate:c=>c.length>128?"Name should be less than 128 characters.":true}]);t=i??t,r=n??r;let a=await te(e.cwd,{withFallback:true}),f=`${e.cwd}/${r}`;try{await m$1.access(e.cwd,m$1.constants.W_OK);}catch{o.break(),o.error(`The path ${s.info(e.cwd)} is not writable.`),o.error(`It is likely you don't have permissions for this folder or the paths ${s.info(e.cwd)} does not exist.`),o.break(),process.exit(1);}return m$1.existsSync(I.resolve(e.cwd,r,"package.json"))&&(o.break(),o.error(`A project with the name ${s.info(r)} already exists.`),o.error("Please choose a different name and try again."),o.break(),process.exit(1)),await V(f,{packageManager:a}),{projectPath:f,projectName:r,template:t}}async function ie(e=process.cwd()){try{let{config:t}=await import('@dotenvx/dotenvx'),r=[".env.local",".env.development.local",".env.development",".env"];for(let i of r){let n=join(e,i);existsSync(n)&&t({path:n,overload:!1,quiet:!0});}}catch(t){o.warn("Failed to load env files:",t);}}var Ae={UNKNOWN_ERROR:"UNKNOWN_ERROR"},_=class extends Error{code;statusCode;context;suggestion;timestamp;cause;constructor(t,r={}){super(t),this.name="RegistryError",this.code=r.code||Ae.UNKNOWN_ERROR,this.statusCode=r.statusCode,this.cause=r.cause,this.context=r.context,this.suggestion=r.suggestion,this.timestamp=new Date,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);}toJSON(){return {name:this.name,message:this.message,code:this.code,statusCode:this.statusCode,context:this.context,suggestion:this.suggestion,timestamp:this.timestamp,stack:this.stack}}};function oe(e){if(o.break(),o.error("Something went wrong. Please check the error below for more details."),o.error("If the problem persists, please open an issue on GitHub."),o.error(""),typeof e=="string"&&(o.error(e),o.break(),process.exit(1)),e instanceof _&&(e.message&&(o.error(e.cause?"Error:":"Message:"),o.error(e.message)),e.cause&&(o.error(`
Message:`),o.error(e.cause)),e.suggestion&&(o.error(`
Suggestion:`),o.error(e.suggestion)),o.break(),process.exit(1)),e instanceof z.ZodError){o.error("Validation failed:");for(let[t,r]of Object.entries(e.flatten().fieldErrors))o.error(`- ${s.info(t)}: ${r}`);o.break(),process.exit(1);}e instanceof Error&&(o.error(e.message),o.break(),process.exit(1)),o.break(),process.exit(1);}process.on("exit",e=>{let t=I.resolve(process.cwd(),"uidesu.config.json");e===0&&o.info("\u2713 uidesu initialized successfully!"),o.info(`Configuration file created at:
${t}`);});var Ge=z.object({cwd:z.string(),name:z.string().optional(),yes:z.boolean(),srcDir:z.boolean().optional()}),se=new Command().name("init").description("initialize a uidesu in your project.").option("-y, --yes","skip prompts and use default values",false).option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).option("--src-dir","use the src directory when creating a new project.",false).action(async e=>{try{let t=Ge.parse({cwd:I.resolve(e.cwd),...e});await ie(t.cwd),await ze(t),o.log(`${s.success("Success!")} Project initialization completed.
You may now add components.`);}catch(t){o.break(),oe(t);}});async function ze(e){let t,i=await Q(e);if(i.errors["1"]){let{projectPath:l,template:u}=await re(e);l||process.exit(1),e.cwd=l,t=await S(e.cwd);}else t=i.projectInfo;let n=await Z(e.cwd,t);console.log(n);let a=n?await Je(n):await We(await O(e.cwd));if(!e.yes){let{proceed:l}=await ne({type:"confirm",name:"proceed",message:`Write configuration to ${s.info("uidesu.config.json")}. Proceed?`,initial:true});l||process.exit(0);}await k(e.cwd,a);let c=d(" Writing components.json").start(),p=I.resolve(e.cwd,"uidesu.config.json");a.registries=Object.fromEntries(Object.entries(a.registries||{}).filter(([l])=>!Object.keys(E).includes(l))),await promises.writeFile(p,`${JSON.stringify(a,null,2)}
`,"utf8"),c.succeed();}async function We(e=null){let[t,r]=await Promise.all([X(),ee()]);o.info("");let i=await ne([{type:"toggle",name:"typescript",message:`Would you like to use ${s.info("TypeScript")} (recommended)?`,initial:e?.tsx??true,active:"yes",inactive:"no"}]);return m.parse({$schema:"https://ui.aodesu.com/schema.json",tsx:i.typescript})}async function Je(e,t){let r=e.style,i=e.tailwind.theme,n=e.tailwind.cssVariables;return m.parse({$schema:e?.$schema,style:r,tailwind:{...e?.tailwind,theme:i,cssVariables:n},tsx:e?.tsx,aliases:e?.aliases})}process.on("SIGNINT",()=>process.exit(0));process.on("SIGTERM",()=>process.exit(0));async function Ke(){let e=new Command().name("uidesu").description("add items from registry to your project").version(B.version,"-v, --version","display the version number");e.addCommand(se).addCommand(K),e.parse();}Ke();//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map