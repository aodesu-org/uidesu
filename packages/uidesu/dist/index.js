#!/usr/bin/env node
import {g}from'./chunk-TLNIZBSZ.js';import {Command}from'commander';import {promises,existsSync}from'fs';import d,{join}from'path';import p,{z}from'zod';import {green,cyan,yellow,red}from'kleur/colors';import M from'fast-glob';import u from'fs-extra';import {loadConfig}from'tsconfig-paths';import $ from'ora';var w={version:"1.0.0"};var n={error:red,warn:yellow,info:cyan,success:green};var o={error(...e){console.log(n.error(e.join(" ")));},warn(...e){console.log(n.warn(e.join(" ")));},info(...e){console.log(n.info(e.join(" ")));},success(...e){console.log(n.success(e.join(" ")));},log(...e){console.log(e.join(" "));},break(){console.log("");}};p.object({cwd:p.string(),registryFile:p.string(),outputDir:p.string()});var R=new Command().name("build").description("build components for a aodesu registry").argument("[registry]","path to registry.json file","./registry.json").option("-o, --output <path>","destination directory for json files","./public/r").option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).action(async(e,t)=>{try{let r=d.resolve(t.cwd),i=d.resolve(r,t.output),s=d.resolve(r,e),a=await promises.readFile(s,"utf-8"),c=g.parse(JSON.parse(a));await promises.mkdir(i,{recursive:!0});let y=c.items.map(x=>({name:x.name,type:x.type}));await promises.writeFile(d.join(i,"index.json"),JSON.stringify(y,null,2)),o.info(`\u2713 Generated ${y.length} items`),o.info(`\u2713 Output directory: ${i}`);}catch(r){r instanceof p.ZodError?(o.error("Invalid registry.json format"),r.errors.forEach(i=>{o.error(`  ${i.path.join(".")}: ${i.message}`);})):r instanceof Error?o.error(r.message):o.error("Unknown error occurred"),process.exit(1);}});var l={"next-app":{name:"next-app",label:"Next.js",links:{installation:"https://ui.uidesu.com/docs/installation/next",tailwind:"https://tailwindcss.com/docs/guides/nextjs"}},"next-pages":{name:"next-pages",label:"Next.js",links:{installation:"https://ui.uidesu.com/docs/installation/next",tailwind:"https://tailwindcss.com/docs/guides/nextjs"}},vite:{name:"vite",label:"Vite",links:{installation:"https://ui.uidesu.com/docs/installation/vite",tailwind:"https://tailwindcss.com/docs/guides/vite"}},manual:{name:"manual",label:"Manual",links:{installation:"https://ui.uidesu.com/docs/installation/manual",tailwind:"https://tailwindcss.com/docs/installation"}}};var U=["**/node_modules/**",".next","public","dist","build"];async function b(e){let[t,r,i]=await Promise.all([M.glob("**/{next,vite,astro,app}.config.*|gatsby-config.*|composer.json|react-router.config.*",{cwd:e,deep:3,ignore:U}),u.pathExists(d.resolve(e,"src")),G(e)]),s=await u.pathExists(d.resolve(e,`${r?"src/":""}app`)),a={framework:l.manual,isSrcDir:r,aliasPrefix:i};return t.find(c=>c.startsWith("next.config."))?.length?(a.framework=s?l["next-app"]:l["next-pages"],a):(t.find(c=>c.startsWith("vite.config."))?.length&&(a.framework=l.vite),a)}async function G(e){let t=await loadConfig(e);if(t?.resultType==="failed"||!Object.entries(t?.paths).length)return null;for(let[r,i]of Object.entries(t.paths))if(i.includes("./*")||i.includes("./src/*")||i.includes("./app/*")||i.includes("./resources/js/*"))return r.replace(/\/\*$/,"")??null;return Object.keys(t?.paths)?.[0].replace(/\/\*$/,"")??null}function m(e,t){return $({text:e,isSilent:t?.silent})}async function v(e){let t={};if(!u.existsSync(e.cwd)||!u.existsSync(d.resolve(e.cwd,"package.json")))return t["1"]=true,{errors:t,ProjectInfo:null};let r=m("Preflight checks.").start();u.existsSync(d.resolve(e.cwd,"uidesu.config.json"))&&(r?.fail(),o.break(),o.error(`A ${n.info("uidesu.config.json")} file already exists at ${n.info(e.cwd)}.
To start over, remove the ${n.info("uidesu.config.json")} file and run ${n.info("uidesu init")} again.`),o.break(),process.exit(1)),r?.succeed();let i=m("Verifying framework.").start(),s=await b(e.cwd);(!s||s?.framework.name==="manual")&&(t["7"]=true,i?.fail(),o.break(),s?.framework.links.installation&&o.error(`We could not detect a supported framework at ${n.info(e.cwd)}.
Visit ${n.info(s?.framework.links.installation)} to manually configure your project.
Once configured, you can use the cli to add components.`),o.break(),process.exit(1)),i?.succeed(`Verifying framework. Found ${n.info(s.framework.label)}.`);}async function k(e=process.cwd()){try{let{config:t}=await import('@dotenvx/dotenvx'),r=[".env.local",".env.development.local",".env.development",".env"];for(let i of r){let s=join(e,i);existsSync(s)&&t({path:s,overload:!1,quiet:!0});}}catch(t){o.warn("Failed to load env files:",t);}}process.on("exit",e=>{let t=d.resolve(process.cwd(),"uidesu.config.json");e===0&&o.info("\u2713 uidesu initialized successfully!"),o.info(`Configuration file created at:
${t}`);});var V=z.object({cwd:z.string(),yes:z.boolean()}),S=new Command().name("init").description("initialize a uidesu in your project.").option("-y, --yes","skip prompts and use default values",false).option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).action(async e=>{try{let t=V.parse({cwd:d.resolve(e.cwd),...e});await k(t.cwd),await Y(t),o.success(`Initialized uidesu in directory: ${e.cwd}`),o.break();}catch{o.break();}});async function Y(e){await v(e);}process.on("SIGNINT",()=>process.exit(0));process.on("SIGTERM",()=>process.exit(0));async function H(){let e=new Command().name("uidesu").description("add items from registry to your project").version(w.version,"-v, --version","display the version number");e.addCommand(S).addCommand(R),e.parse();}H();//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map